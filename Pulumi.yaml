name: actions-aws-webserver
runtime: yaml

config:
  container:image:
    type: string
  container:cpu:
    type: integer
  container:memory:
    type: integer

resources:
  lb:
    type: awsx:lb:ApplicationLoadBalancer
  cluster:
    type: aws:ecs:Cluster
  service:
    type: awsx:ecs:FargateService
    properties:
      cluster: ${cluster.arn}
      assignPublicIp: true
      taskDefinitionArgs:
        container:
          name: service
          image: ${container:image}
          cpu: ${container:cpu}
          memory: ${container:memory}
          essential: true
          portMappings:
            - containerPort: 80
              targetGroup: ${lb.defaultTargetGroup}
outputs:
  url: http://${lb.loadBalancer.dnsName}